<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro de Gastos</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%); overflow:hidden; height:100vh; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif; }
        .app-container { display:flex; flex-direction:column; height:100vh; overflow:hidden; }
        .header { height:72px; background:white; box-shadow:0 2px 4px rgba(0,0,0,0.1); z-index:10; flex-shrink:0; padding-top:16px; }
        .main-content { flex:1; overflow-y:auto; overflow-x:hidden; padding-bottom:env(safe-area-inset-bottom); }
        .bottom-nav { height:64px; background:white; border-top:1px solid #e5e7eb; display:flex; justify-content:space-around; align-items:center; flex-shrink:0; z-index:100; padding-bottom:env(safe-area-inset-bottom); }
        .bottom-nav-item { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:8px 16px; cursor:pointer; transition:all 0.2s; flex:1; gap:4px; }
        .bottom-nav-item.active { color:#2563eb; }
        .bottom-nav-item:not(.active) { color:#6b7280; }
        .fab { position:fixed; bottom:90px; right:16px; width:56px; height:56px; background:#2563eb; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 6px rgba(0,0,0,0.3); cursor:pointer; z-index:99; transition: transform 0.2s; }
        .fab:active { transform:scale(0.95); }
        .modal-overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:200; display:flex; align-items:flex-end; animation:fadeIn 0.2s; }
        .modal-content { background:white; border-radius:16px 16px 0 0; width:100%; max-height:85vh; overflow-y:auto; animation:slideUp 0.3s; padding-bottom:env(safe-area-inset-bottom); }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
        @keyframes slideUp { from{transform:translateY(100%);} to{transform:translateY(0);} }
        .toast { position:fixed; bottom:90px; left:50%; transform:translateX(-50%); background:#1f2937; color:white; padding:12px 24px; border-radius:8px; z-index:300; animation:toastIn 0.3s, toastOut 0.3s 2.7s; box-shadow:0 4px 6px rgba(0,0,0,0.3); }
        @keyframes toastIn { from{opacity:0; transform:translate(-50%,20px);} to{opacity:1; transform:translate(-50%,0);} }
        @keyframes toastOut { from{opacity:1; transform:translate(-50%,0);} to{opacity:0; transform:translate(-50%,20px);} }
        .scrollbar-hide::-webkit-scrollbar { display:none; }
        .scrollbar-hide { -ms-overflow-style:none; scrollbar-width:none; }
        .balance-card { background:white; border-radius:12px; padding:12px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
        .transaction-item { background:white; border-radius:8px; padding:12px; margin-bottom:8px; box-shadow:0 1px 2px rgba(0,0,0,0.05); transition:all 0.2s; }
        .transaction-item:active { transform:scale(0.98); }
        input, select, textarea { font-size:16px !important; }
        .chart-container { position:relative; height:280px; width:100%; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const CATEGORIAS_INICIALES = { 
            ingresos:['Salario','Freelance','Inversiones','Otros Ingresos'], 
            gastos:['Alimentaci√≥n','Transporte','Vivienda','Entretenimiento','Salud','Educaci√≥n','Otros Gastos'] 
        };

        function Toast({ message, onClose }) {
            useEffect(()=>{ 
                const timer=setTimeout(()=>onClose(),3000); 
                return ()=>clearTimeout(timer); 
            },[onClose]);
            return <div className="toast">{message}</div>;
        }

        function Modal({ isOpen, onClose, title, children }) {
            if(!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e=>e.stopPropagation()}>
                        <div className="sticky top-0 bg-white border-b border-gray-200 px-4 py-3 flex justify-between items-center">
                            <h3 className="text-lg font-bold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="text-2xl text-gray-500 hover:text-gray-700">√ó</button>
                        </div>
                        <div className="p-4">{children}</div>
                    </div>
                </div>
            );
        }

        function GraficoTransacciones({ transacciones }) {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);
            
            useEffect(()=>{
                if(!canvasRef.current || !transacciones || transacciones.length===0) return;
                if(chartRef.current) chartRef.current.destroy();
                
                const ingresos = transacciones.filter(t=>t.tipo==='ingreso');
                const gastos = transacciones.filter(t=>t.tipo==='gasto');
                
                const data = {
                    labels:[...ingresos.map(t=>t.categoria), ...gastos.map(t=>t.categoria)],
                    datasets:[
                        { 
                            label:'Ingresos', 
                            data:ingresos.map(t=>t.monto), 
                            backgroundColor:'#10B981', 
                            borderColor:'#fff', 
                            borderWidth:2 
                        },
                        { 
                            label:'Gastos', 
                            data:gastos.map(t=>t.monto), 
                            backgroundColor:'#EF4444', 
                            borderColor:'#fff', 
                            borderWidth:2 
                        }
                    ]
                };
                
                const ctx=canvasRef.current.getContext('2d');
                chartRef.current = new Chart(ctx,{ 
                    type:'bar', 
                    data:data, 
                    options:{ 
                        responsive:true, 
                        maintainAspectRatio:false, 
                        plugins:{ 
                            legend:{ display:true, position:'top' }, 
                            tooltip:{ 
                                callbacks:{ 
                                    label:function(context){ 
                                        const label=context.dataset.label||''; 
                                        const value=context.parsed.y||0; 
                                        return `${label}: $${value.toLocaleString('es-MX',{minimumFractionDigits:2})}`; 
                                    } 
                                } 
                            } 
                        }, 
                        scales:{ 
                            y:{ 
                                beginAtZero:true, 
                                ticks:{ 
                                    callback:function(value){ 
                                        return '$'+value.toLocaleString('es-MX'); 
                                    } 
                                } 
                            } 
                        } 
                    } 
                });
                
                return ()=>{ if(chartRef.current) chartRef.current.destroy(); };
            },[transacciones]);
            
            if(!transacciones || transacciones.length===0) {
                return (
                    <div className="text-center py-12 text-gray-500">
                        <div className="text-4xl mb-2">üìä</div>
                        <p className="text-sm">No hay transacciones para mostrar</p>
                    </div>
                );
            }
            
            return <div className="chart-container"><canvas ref={canvasRef}></canvas></div>;
        }

        // Funci√≥n corregida para exportar Excel con Capacitor
        async function guardarYCompartirExcel(nombreArchivo, wb, mostrarToast){
            try{
                // Verificar si Capacitor est√° disponible
                if (!window.Capacitor || !window.Capacitor.Plugins) {
                    // Fallback para navegador web
                    XLSX.writeFile(wb, nombreArchivo);
                    mostrarToast('‚úÖ Archivo descargado');
                    return;
                }

                const { Filesystem, Directory } = window.Capacitor.Plugins;
                const { Share } = window.Capacitor.Plugins;
                
                // Convertir workbook a array buffer
                const wbout = XLSX.write(wb, {bookType:'xlsx', type:'array'});
                const blob = new Blob([wbout], {type:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
                
                // Convertir blob a base64
                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const base64 = reader.result.split(',')[1];
                        
                        // Guardar archivo en el dispositivo
                        const result = await Filesystem.writeFile({
                            path: nombreArchivo,
                            data: base64,
                            directory: Directory.Documents
                        });
                        
                        console.log('Archivo guardado:', result);
                        
                        // Obtener la URI del archivo guardado
                        const uriResult = await Filesystem.getUri({
                            path: nombreArchivo,
                            directory: Directory.Documents
                        });
                        
                        // Compartir el archivo
                        await Share.share({
                            title: 'Exportar Excel',
                            text: 'Registro de Gastos',
                            url: uriResult.uri,
                            dialogTitle: 'Compartir archivo Excel'
                        });
                        
                        mostrarToast('‚úÖ Archivo exportado correctamente');
                    } catch (error) {
                        console.error('Error al guardar/compartir:', error);
                        mostrarToast('‚ùå Error al exportar: ' + error.message);
                    }
                };
                
                reader.onerror = (error) => {
                    console.error('Error al leer blob:', error);
                    mostrarToast('‚ùå Error al procesar archivo');
                };
                
                reader.readAsDataURL(blob);
                
            } catch(error) {
                console.error('Error general en exportaci√≥n:', error);
                mostrarToast('‚ùå Error: ' + error.message);
            }
        }

        function App() {
            const [pestanaActiva, setPestanaActiva]=useState('analisis');
            const [transacciones,setTransacciones]=useState([]);
            const [categorias,setCategorias]=useState(CATEGORIAS_INICIALES);
            const [modalAbierto,setModalAbierto]=useState(false);
            const [modalFiltros,setModalFiltros]=useState(false);
            const [toast,setToast]=useState(null);
            const [filtroModo,setFiltroModo]=useState('todos');
            const [mesSeleccionado,setMesSeleccionado]=useState(new Date().getMonth());
            const [anioSeleccionado,setAnioSeleccionado]=useState(new Date().getFullYear());
            const [fechaInicio,setFechaInicio]=useState('');
            const [fechaFin,setFechaFin]=useState('');
            const [formulario,setFormulario]=useState({ 
                tipo:'gasto', 
                monto:'', 
                categoria:'', 
                descripcion:'', 
                fecha:new Date().toISOString().split('T')[0] 
            });
            const [nuevaCategoria,setNuevaCategoria]=useState('');
            const [tipoCategoria,setTipoCategoria]=useState('gastos');

            // Cargar datos guardados
            useEffect(()=>{ 
                const datosGuardados=localStorage.getItem('transacciones'); 
                if(datosGuardados) setTransacciones(JSON.parse(datosGuardados)); 
                const catGuardadas=localStorage.getItem('categorias'); 
                if(catGuardadas) setCategorias(JSON.parse(catGuardadas)); 
            },[]);
            
            useEffect(()=>{ 
                localStorage.setItem('transacciones',JSON.stringify(transacciones)); 
            },[transacciones]);
            
            useEffect(()=>{ 
                localStorage.setItem('categorias',JSON.stringify(categorias)); 
            },[categorias]);

            const transaccionesFiltradas=useMemo(()=>{
                if(filtroModo==='todos') return transacciones;
                return transacciones.filter(t=>{
                    const fecha=new Date(t.fecha);
                    if(filtroModo==='mes-actual'){ 
                        const hoy=new Date(); 
                        return fecha.getMonth()===hoy.getMonth() && fecha.getFullYear()===hoy.getFullYear(); 
                    }
                    if(filtroModo==='mes-especifico') {
                        return fecha.getMonth()===mesSeleccionado && fecha.getFullYear()===anioSeleccionado;
                    }
                    if(filtroModo==='rango' && fechaInicio && fechaFin){ 
                        const inicio=new Date(fechaInicio); 
                        const fin=new Date(fechaFin); 
                        return fecha>=inicio && fecha<=fin; 
                    }
                    return true;
                });
            },[transacciones,filtroModo,mesSeleccionado,anioSeleccionado,fechaInicio,fechaFin]);

            const mostrarToast=(mensaje)=>{ setToast(mensaje); };
            
            const agregarTransaccion=()=>{
                if(!formulario.monto||!formulario.categoria){ 
                    alert('Por favor completa todos los campos obligatorios'); 
                    return; 
                }
                const nuevaTrans={
                    ...formulario,
                    id:Date.now(), 
                    monto:parseFloat(formulario.monto)
                };
                setTransacciones([nuevaTrans,...transacciones]);
                setFormulario({ 
                    tipo:'gasto', 
                    monto:'', 
                    categoria:'', 
                    descripcion:'', 
                    fecha:new Date().toISOString().split('T')[0] 
                });
                setModalAbierto(false);
                mostrarToast('‚úÖ Transacci√≥n registrada');
            };

            const eliminarTransaccion=(id)=>{ 
                if(confirm('¬øEliminar esta transacci√≥n?')){ 
                    setTransacciones(transacciones.filter(t=>t.id!==id)); 
                    mostrarToast('üóëÔ∏è Transacci√≥n eliminada'); 
                } 
            };
            
            const agregarCategoria=()=>{ 
                if(!nuevaCategoria.trim()){ 
                    alert('Por favor ingresa un nombre para la categor√≠a'); 
                    return; 
                } 
                if(categorias[tipoCategoria].includes(nuevaCategoria.trim())){ 
                    alert('Esta categor√≠a ya existe'); 
                    return; 
                } 
                setCategorias({
                    ...categorias,
                    [tipoCategoria]:[...categorias[tipoCategoria],nuevaCategoria.trim()]
                }); 
                setNuevaCategoria(''); 
                mostrarToast('‚úÖ Categor√≠a agregada'); 
            };
            
            const eliminarCategoria=(tipo,categoria)=>{ 
                if(confirm(`¬øEliminar la categor√≠a "${categoria}"?`)){ 
                    setCategorias({
                        ...categorias,
                        [tipo]:categorias[tipo].filter(cat=>cat!==categoria)
                    }); 
                    mostrarToast('üóëÔ∏è Categor√≠a eliminada'); 
                } 
            };
            
            const calcularBalance=()=>{ 
                const ingresos=transaccionesFiltradas.filter(t=>t.tipo==='ingreso').reduce((s,t)=>s+t.monto,0); 
                const gastos=transaccionesFiltradas.filter(t=>t.tipo==='gasto').reduce((s,t)=>s+t.monto,0); 
                return {ingresos,gastos,balance:ingresos-gastos}; 
            };
            
            const {ingresos,gastos,balance}=calcularBalance();
            const categoriasDisponibles=formulario.tipo==='ingreso'?categorias.ingresos:categorias.gastos;

            // Funci√≥n para exportar a Excel
            const exportarExcel = async () => {
                if(transaccionesFiltradas.length===0){ 
                    alert('No hay transacciones para exportar'); 
                    return; 
                }
                
                const {ingresos,gastos,balance}=calcularBalance();
                const datosExcel=transaccionesFiltradas.map(t=>({ 
                    'Fecha':new Date(t.fecha).toLocaleDateString('es-MX'), 
                    'Tipo':t.tipo==='ingreso'?'Ingreso':'Gasto', 
                    'Categor√≠a':t.categoria, 
                    'Descripci√≥n':t.descripcion, 
                    'Monto':t.monto 
                }));
                
                datosExcel.push({}); 
                datosExcel.push({ 
                    'Fecha':'',
                    'Tipo':'',
                    'Categor√≠a':'',
                    'Descripci√≥n':'TOTAL INGRESOS',
                    'Monto':ingresos 
                });
                datosExcel.push({ 
                    'Fecha':'',
                    'Tipo':'',
                    'Categor√≠a':'',
                    'Descripci√≥n':'TOTAL GASTOS',
                    'Monto':gastos 
                });
                datosExcel.push({ 
                    'Fecha':'',
                    'Tipo':'',
                    'Categor√≠a':'',
                    'Descripci√≥n':'BALANCE',
                    'Monto':balance 
                });
                
                const ws=XLSX.utils.json_to_sheet(datosExcel);
                const wb=XLSX.utils.book_new(); 
                XLSX.utils.book_append_sheet(wb,ws,'Transacciones');
                
                let nombrePeriodo='Todas';
                if(filtroModo==='mes-actual') nombrePeriodo='MesActual';
                else if(filtroModo==='mes-especifico'){ 
                    const meses=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre']; 
                    nombrePeriodo=`${meses[mesSeleccionado]}_${anioSeleccionado}`; 
                }
                else if(filtroModo==='rango' && fechaInicio && fechaFin) nombrePeriodo='RangoPersonalizado';
                
                const fecha=new Date().toISOString().split('T')[0];
                const nombreArchivo=`Finanzas_${nombrePeriodo}_${fecha}.xlsx`;
                
                await guardarYCompartirExcel(nombreArchivo, wb, mostrarToast);
            };

            return (
                <div className="app-container">
                    {/* Header */}
                    <div className="header flex items-center justify-between px-4">
                        <h1 className="text-lg font-bold text-gray-800">üí∞ Registro de Gastos</h1>
                        {pestanaActiva==='transacciones'&&(
                            <div className="flex gap-2">
                                <button 
                                    onClick={()=>setModalFiltros(true)} 
                                    className="text-sm bg-blue-600 text-white px-3 py-1.5 rounded-lg"
                                >
                                    üìÖ Filtrar
                                </button>
                                <button 
                                    onClick={exportarExcel} 
                                    className="text-sm bg-green-600 text-white px-3 py-1.5 rounded-lg"
                                >
                                    üìä Excel
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Main Content */}
                    <div className="main-content scrollbar-hide">
                        {pestanaActiva==='analisis'&&(
                            <div className="p-4 space-y-4">
                                <div className="balance-card">
                                    <div className="text-sm text-gray-500 mb-2">Balance Total</div>
                                    <div className={`text-3xl font-bold ${balance>=0?'text-green-600':'text-red-600'}`}>
                                        ${balance.toLocaleString('es-MX',{minimumFractionDigits:2})}
                                    </div>
                                    <div className="flex justify-between mt-4 pt-4 border-t border-gray-200">
                                        <div>
                                            <div className="text-xs text-gray-500">Ingresos</div>
                                            <div className="text-lg font-semibold text-green-600">
                                                ${ingresos.toLocaleString('es-MX',{minimumFractionDigits:2})}
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-xs text-gray-500">Gastos</div>
                                            <div className="text-lg font-semibold text-red-600">
                                                ${gastos.toLocaleString('es-MX',{minimumFractionDigits:2})}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <h3 className="text-lg font-bold mb-4 text-gray-800">Gr√°fico de Transacciones</h3>
                                    <GraficoTransacciones transacciones={transaccionesFiltradas} />
                                </div>
                            </div>
                        )}

                        {pestanaActiva==='transacciones'&&(
                            <div className="p-4">
                                {transaccionesFiltradas.length===0?(
                                    <div className="text-center py-12 text-gray-500">
                                        <div className="text-4xl mb-2">üìù</div>
                                        <p className="text-sm">No hay transacciones registradas</p>
                                        <p className="text-xs mt-2">Presiona el bot√≥n + para agregar una</p>
                                    </div>
                                ):(
                                    <div className="space-y-2">
                                        {transaccionesFiltradas.map(t=>(
                                            <div key={t.id} className="transaction-item">
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className={`text-xs px-2 py-0.5 rounded ${t.tipo==='ingreso'?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}`}>
                                                                {t.tipo==='ingreso'?'Ingreso':'Gasto'}
                                                            </span>
                                                            <span className="text-sm font-semibold text-gray-800">{t.categoria}</span>
                                                        </div>
                                                        {t.descripcion&&<p className="text-sm text-gray-600 mb-1">{t.descripcion}</p>}
                                                        <p className="text-xs text-gray-400">{new Date(t.fecha).toLocaleDateString('es-MX')}</p>
                                                    </div>
                                                    <div className="text-right ml-4">
                                                        <div className={`text-lg font-bold ${t.tipo==='ingreso'?'text-green-600':'text-red-600'}`}>
                                                            {t.tipo==='ingreso'?'+':'-'}${t.monto.toLocaleString('es-MX',{minimumFractionDigits:2})}
                                                        </div>
                                                        <button 
                                                            onClick={()=>eliminarTransaccion(t.id)} 
                                                            className="text-xs text-red-500 hover:text-red-700 mt-1"
                                                        >
                                                            Eliminar
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {pestanaActiva==='categorias'&&(
                            <div className="p-4 space-y-6">
                                <div>
                                    <h3 className="text-lg font-bold mb-3 text-gray-800">Categor√≠as de Ingresos</h3>
                                    <div className="space-y-2">
                                        {categorias.ingresos.map((cat,idx)=>(
                                            <div key={idx} className="flex justify-between items-center bg-white p-3 rounded-lg">
                                                <span className="text-gray-700">{cat}</span>
                                                <button 
                                                    onClick={()=>eliminarCategoria('ingresos',cat)} 
                                                    className="text-red-500 text-sm"
                                                >
                                                    Eliminar
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-lg font-bold mb-3 text-gray-800">Categor√≠as de Gastos</h3>
                                    <div className="space-y-2">
                                        {categorias.gastos.map((cat,idx)=>(
                                            <div key={idx} className="flex justify-between items-center bg-white p-3 rounded-lg">
                                                <span className="text-gray-700">{cat}</span>
                                                <button 
                                                    onClick={()=>eliminarCategoria('gastos',cat)} 
                                                    className="text-red-500 text-sm"
                                                >
                                                    Eliminar
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="bg-white p-4 rounded-lg">
                                    <h4 className="font-semibold mb-3 text-gray-800">Agregar Nueva Categor√≠a</h4>
                                    <select 
                                        value={tipoCategoria} 
                                        onChange={e=>setTipoCategoria(e.target.value)} 
                                        className="w-full p-2 border rounded-lg mb-2"
                                    >
                                        <option value="gastos">Gasto</option>
                                        <option value="ingresos">Ingreso</option>
                                    </select>
                                    <input 
                                        type="text" 
                                        value={nuevaCategoria} 
                                        onChange={e=>setNuevaCategoria(e.target.value)} 
                                        placeholder="Nombre de la categor√≠a" 
                                        className="w-full p-2 border rounded-lg mb-2"
                                    />
                                    <button 
                                        onClick={agregarCategoria} 
                                        className="w-full bg-blue-600 text-white py-2 rounded-lg"
                                    >
                                        Agregar
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* FAB */}
                    {pestanaActiva==='transacciones'&&(
                        <div className="fab" onClick={()=>setModalAbierto(true)}>
                            <span className="text-white text-2xl">+</span>
                        </div>
                    )}

                    {/* Bottom Nav */}
                    <div className="bottom-nav">
                        <div 
                            className={`bottom-nav-item ${pestanaActiva==='analisis'?'active':''}`} 
                            onClick={()=>setPestanaActiva('analisis')}
                        >
                            <span className="text-2xl">üìà</span>
                            <span className="text-xs">An√°lisis</span>
                        </div>
                        <div 
                            className={`bottom-nav-item ${pestanaActiva==='transacciones'?'active':''}`} 
                            onClick={()=>setPestanaActiva('transacciones')}
                        >
                            <span className="text-2xl">üìä</span>
                            <span className="text-xs">Transacciones</span>
                        </div>
                        <div 
                            className={`bottom-nav-item ${pestanaActiva==='categorias'?'active':''}`} 
                            onClick={()=>setPestanaActiva('categorias')}
                        >
                            <span className="text-2xl">üè∑Ô∏è</span>
                            <span className="text-xs">Categor√≠as</span>
                        </div>
                    </div>

                    {/* Modal Agregar Transacci√≥n */}
                    <Modal 
                        isOpen={modalAbierto} 
                        onClose={()=>setModalAbierto(false)} 
                        title="Nueva Transacci√≥n"
                    >
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Tipo</label>
                                <select 
                                    value={formulario.tipo} 
                                    onChange={e=>setFormulario({...formulario,tipo:e.target.value,categoria:''})} 
                                    className="w-full p-3 border rounded-lg"
                                >
                                    <option value="gasto">Gasto</option>
                                    <option value="ingreso">Ingreso</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Categor√≠a *</label>
                                <select 
                                    value={formulario.categoria} 
                                    onChange={e=>setFormulario({...formulario,categoria:e.target.value})} 
                                    className="w-full p-3 border rounded-lg"
                                >
                                    <option value="">Selecciona una categor√≠a</option>
                                    {categoriasDisponibles.map((cat,idx)=>(
                                        <option key={idx} value={cat}>{cat}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Monto *</label>
                                <input 
                                    type="number" 
                                    step="0.01" 
                                    value={formulario.monto} 
                                    onChange={e=>setFormulario({...formulario,monto:e.target.value})} 
                                    placeholder="0.00" 
                                    className="w-full p-3 border rounded-lg"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Descripci√≥n</label>
                                <textarea 
                                    value={formulario.descripcion} 
                                    onChange={e=>setFormulario({...formulario,descripcion:e.target.value})} 
                                    placeholder="Detalles opcionales" 
                                    rows="3" 
                                    className="w-full p-3 border rounded-lg"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Fecha</label>
                                <input 
                                    type="date" 
                                    value={formulario.fecha} 
                                    onChange={e=>setFormulario({...formulario,fecha:e.target.value})} 
                                    className="w-full p-3 border rounded-lg"
                                />
                            </div>
                            <button 
                                onClick={agregarTransaccion} 
                                className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold"
                            >
                                Guardar Transacci√≥n
                            </button>
                        </div>
                    </Modal>

                    {/* Modal Filtros */}
                    <Modal 
                        isOpen={modalFiltros} 
                        onClose={()=>setModalFiltros(false)} 
                        title="Filtrar Transacciones"
                    >
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Modo de Filtro</label>
                                <select 
                                    value={filtroModo} 
                                    onChange={e=>setFiltroModo(e.target.value)} 
                                    className="w-full p-3 border rounded-lg"
                                >
                                    <option value="todos">Todas las transacciones</option>
                                    <option value="mes-actual">Mes actual</option>
                                    <option value="mes-especifico">Mes espec√≠fico</option>
                                    <option value="rango">Rango personalizado</option>
                                </select>
                            </div>
                            {filtroModo==='mes-especifico'&&(
                                <>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Mes</label>
                                        <select 
                                            value={mesSeleccionado} 
                                            onChange={e=>setMesSeleccionado(parseInt(e.target.value))} 
                                            className="w-full p-3 border rounded-lg"
                                        >
                                            {['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'].map((m,i)=>(
                                                <option key={i} value={i}>{m}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">A√±o</label>
                                        <input 
                                            type="number" 
                                            value={anioSeleccionado} 
                                            onChange={e=>setAnioSeleccionado(parseInt(e.target.value))} 
                                            className="w-full p-3 border rounded-lg"
                                        />
                                    </div>
                                </>
                            )}
                            {filtroModo==='rango'&&(
                                <>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Fecha Inicio</label>
                                        <input 
                                            type="date" 
                                            value={fechaInicio} 
                                            onChange={e=>setFechaInicio(e.target.value)} 
                                            className="w-full p-3 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Fecha Fin</label>
                                        <input 
                                            type="date" 
                                            value={fechaFin} 
                                            onChange={e=>setFechaFin(e.target.value)} 
                                            className="w-full p-3 border rounded-lg"
                                        />
                                    </div>
                                </>
                            )}
                            <button 
                                onClick={()=>setModalFiltros(false)} 
                                className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold"
                            >
                                Aplicar Filtros
                            </button>
                        </div>
                    </Modal>

                    {/* Toast */}
                    {toast&&<Toast message={toast} onClose={()=>setToast(null)}/>}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>